<main>
  <div class="cards flex flex-wrap w-full justify-evenly md:gap-2 ">
    <% @guidelines.each do |guide| %>
      <div style="background-color: <%= guide[:color] %>;" class="max-w-md p-4 border border-gray-200 rounded-2xl shadow dark:bg-gray-800 dark:border-gray-700">
        <div class="rounded-full w-fit h-auto bg-black p-2">
          <%= image_tag(guide[:icon], alt: guide[:title], class: 'h-8 w-8') %>
        </div>
        <a href="<%= guide[:link] %>">
          <h5 class="mb-2 text-2xl font-semibold tracking-tight text-gray-900 dark:text-white">
            <%= guide[:title] %>
          </h5>
        </a>
        <p class="mb-3 font-normal text-gray-500 dark:text-gray-400">
          <%= guide[:count] %> <%= guide[:units] %>
        </p>
      </div>
    <% end %>
  </div>
  <section class="bottom section md:flex md:flex-wrap">
    <div class="sectional-data md:w-1/2 p-4">
      <div class="mb-4 border-b border-gray-200 dark:border-gray-700">
        <div class="relative w-full inline-flex justify-between">
          <button class="inline-flex w-full text-sm font-medium text-gray-700 bg-white dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700" type="button" id="tabsDropdownButton" data-dropdown-toggle="tabsDropdown">
            View Data analysis 
            <svg class="w-5 h-5 ml-2 -mr-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div id="tabsDropdown" class="hidden z-10 w-44 bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-800" style= transform: translate3d(20.4px, 74.4px, 0px);">
            <ul class="py-2 text-sm text-gray-700 dark:text-gray-200">
              <li>
                <button class="w-full px-4 py-2 text-left" data-tabs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">District Donations</button>
              </li>
              <li>
                <button class="w-full px-4 py-2 text-left" data-tabs-target="#request-type" type="button" role="tab" aria-controls="request-type" aria-selected="false">Request Type</button>
              </li>
              <li>
                <button class="w-full px-4 py-2 text-left" data-tabs-target="#daily-donation-types" type="button" role="tab" aria-controls="daily-donation-types" aria-selected="false">Daily donation type</button>
              </li>
              <li>
                <button class="w-full px-4 py-2 text-left" data-tabs-target="#users-and-events-weekly" type="button" role="tab" aria-controls="users-and-events-weekly" aria-selected="false">Users and Events Weekly</button>
              </li>
            </ul>
          </div>
          <div class="flex">
            <span class="p-2 ">
              <div>
                <form id="group_by_form" class="flex flex-row w-fit" action="<%= authenticated_root_path %>" method="get" data-turbo-frame="_charts">
                  <label for="group_by">Group By:</label>
                  <select id="group_by" class="rounded-xl" name="group_by" onchange="this.form.requestSubmit();">
                    <option value="day" <%= 'selected' if params[:group_by] == 'seconds' %>>Seconds</option>
                    <option value="day" <%= 'selected' if params[:group_by] == 'day' %>>Day</option>
                    <option value="week" <%= 'selected' if params[:group_by] == 'week' %>>Week</option>
                    <option value="month" <%= 'selected' if params[:group_by] == 'month' %>>Month</option>
                </select>
             </form>
            </div>
            </span>
            <span class="p-2"><i class="fa-solid fa-share-nodes"></i></span>
            <span class="p-2" ><i class="fa-solid fa-download"></i></i></span>
        </div>
      </div>
    </div>
    <!-- Tab Content -->
    <turbo-frame id="_charts">
      <div id="default-tab-content">
        <div class="p-4 rounded-lg bg-gray-50 dark:bg-gray-800" id="profile" role="tabpanel">
          <%= column_chart @donations_by_district, stacked: true, title: "Donations per District", downloadable: true %>
        </div>
                      <div class="p-4 rounded-lg bg-gray-50 dark:bg-gray-800 hidden" id="request-type" role="tabpanel">
                        <%= line_chart @chart_data, title: "Request Types", ytitle: "Number of Requests", downloadable: true %>
                      </div>
                      <div class="p-4 rounded-lg bg-gray-50 dark:bg-gray-800 hidden" id="daily-donation-types" role="tabpanel">
                        <%= line_chart @inventory_trends, title: "Inventory Trends", xtitle: "Inventory" %>
                      </div>
                      <div class="p-4 rounded-lg bg-gray-50 dark:bg-gray-800 hidden" id="users-and-events-weekly" role="tabpanel">
                        <%= line_chart [{ name: "Events", data: @events_per_week }, { name: "Users", data: @users_per_week }], title: "Users and Events" %>
                      </div>
                    </div>
                  </turbo-frame>
                </div>
                <div id="sectional-data2" class="flex flex-col md:w-1/2 md:flex-row">
                  <div id=pill-cards-section" class="flex justify-evenly md:w-1/4 md:flex-col">
                    <a href="#" class="block  bg-[#302C51] border p-4 border-gray-200 rounded-xl shadow  text-white">
                      <h2>Total Staffs</h2>
                      <p><%= @staffs %></p>
                    </a>
                    <a href="#" class="block  bg-[#302C51] border p-4 border-gray-200 rounded-xl shadow  text-white">
                      <h2>Total Volunteer</h2>
                      <p><%= @volunteers %></p>
                    </a>
                    <a href="#" class="block  bg-[#302C51] border p-4 border-gray-200 rounded-xl shadow  text-white">
                      <h2>Donor Success rate</h2>
                      <p>75%</p>
                    </a>
                  </div>
                  <div id="beneficiary-ratio" class="md:w-3/4">
                    <div class="flex flex-col p-8 justify-center">
                      <div class="bg-gray-200 rounded-xl p-8">
                        <%= pie_chart @beneficiary_data, donut: true, title: "Beneficiary Type Ratio", colors: ["#FF5733", "#33FF57", "#3357FF"] %>
                      </div>
                    </div>
                  </div>
                </section>
                <section id="recent-activities" class="mt-4">
                  <h4 class="text-center">Recent Activities</h4>
                  <div class="flex  flex-row">
                    <p class="text-center">No new activities detected</p>
                  </div>
                </section>
              </main>
              <script>
                document.addEventListener("DOMContentLoaded", () => {
                // Dropdown toggle
                const dropdownButton = document.getElementById("tabsDropdownButton");
                const dropdownMenu = document.getElementById("tabsDropdown");
                dropdownButton.addEventListener("click", () => {
                  dropdownMenu.classList.toggle("hidden");
                });

                // Tab switching
                const tabButtons = document.querySelectorAll("[data-tabs-target]");
                tabButtons.forEach((button) => {
                  button.addEventListener("click", (event) => {
                    // Hide all tab contents
                    document.querySelectorAll("[role='tabpanel']").forEach((tab) => {
                      tab.classList.add("hidden");
                    });

                    // Remove active state from all buttons
                    tabButtons.forEach((btn) => {
                      btn.setAttribute("aria-selected", "false");
                    });

                    // Show the targeted tab and set active state
                    const target = document.querySelector(button.getAttribute("data-tabs-target"));
                    target.classList.remove("hidden");
                    button.setAttribute("aria-selected", "true");

                    // Hide the dropdown
                    dropdownMenu.classList.add("hidden");
                  });
                });
                });
              </script>
