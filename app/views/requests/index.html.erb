
<%= render 'requests/cardLayout' %>
<div class="flex justify-between items-center p-5">
  <div class="block md:hidden">
    <%= button_to new_request_path, method: :get do %>
      <svg width="41" height="41" viewBox="0 0 41 41" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="20.5" cy="20.5" r="20.5" fill="#6DC13D"/>
        <path d="M20 9.33331V32.6666M8.33333 21H31.6667" stroke="white" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    <% end %>
  </div>
  <p class="hidden md:block font-semi-bold text-lg">Requests</p>
  <div>
    <div class="hidden md:inline-flex py-2 px-4 bg-lightGreen text-white rounded-xl">
      <%= link_to "Add New", new_request_path, class:"rounded" %>
    </div>
    <button id="filter-modal-button" class="font-medium py-1.5 px-4 rounded-xl border-2 border-lightGreen text-lightGreen">
      <i class="fa-solid fa-filter fa-xl"></i>
      <span>Filter</span>
    </button>
    <%= link_to "Clear", requests_path, id:"reset-filter-button", class: "font-medium px-4 py-2 text-lightGreen rounded-xl border-2 border-lightGreen" %>
  </div>
</div>
<div id="filter-modal" class="fixed inset-0 z-50 hidden bg-gray-900 bg-opacity-50 justify-center items-center">
  <div class="bg-white rounded-lg shadow-lg w-11/12 md:w-1/2 p-6">
    <div class="flex justify-between items-center pb-3 border-b">
      <h3 class="text-lg font-medium text-gray-900">Filter Requests</h3>
      <button id="close-modal-button" class="text-gray-400 hover:text-gray-600">
        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <!-- Filter Form -->
    <div class="mt-4 max-h-96 overflow-auto">
      <%= form_with url: requests_path, method: :get, local: true, class: "space-y-4" do |f| %>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <!-- Name Filter -->
          <div>
            <%= f.label :name, "Name", class: "block text-sm font-medium text-gray-700" %>
            <%= f.text_field :name, value: params[:name], class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
          </div>
          <!-- Phone Number Filter -->
          <div>
            <%= f.label :phone_number, "Phone Number", class: "block text-sm font-medium text-gray-700" %>
            <%= f.text_field :phone_number, value: params[:phone_number], class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
          </div>
          <!-- Request Type Filter -->
          <div>
            <%= f.label :request_type, "Request Type", class: "block text-sm font-medium text-gray-700" %>
            <%= f.select :request_type, options_for_select([["Food Request", "food_request"], ["Donation Request", "donation_request"], ["Others", "others"]]), { include_blank: "Select" }, class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
          </div>
          <!-- Location Filters -->
          <div>
            <%= f.label :district_id, "District", class: "block text-sm font-medium text-gray-700" %>
            <%= f.collection_select :district_id, @districts, :id, :name, { prompt: 'Select a district' }, { id: 'district-select', class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md", 'data-context-path': 'requests' } %>
          </div>
          <div>
            <%= f.label :county_id, "County", class: "block text-sm font-medium text-gray-700" %>
            <%= f.collection_select :county_id, @counties, :id, :name, { prompt: 'Select a county' }, { id: 'county-select', class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md", 'data-context-path': 'requests' } %>
          </div>
          <div>
            <%= f.label :sub_county_id, "Sub County", class: "block text-sm font-medium text-gray-700" %>
            <%= f.collection_select :sub_county_id, @sub_counties, :id, :name, { prompt: 'Select a sub-county' }, { id: 'sub-county-select', class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" } %>
          </div>
          <!-- Approved Filter -->
          <div>
            <%= f.label :is_selected, "Approved?", class: "block text-sm font-medium text-gray-700" %>
            <%= f.select :is_selected, [["Yes", true], ["No", false]], { include_blank: "Select" }, class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
          </div>
          <!-- Branch Filter -->
          <div>
            <%= f.label :branch_id, "Branch", class: "block text-sm font-medium text-gray-700" %>
            <%= f.collection_select :branch_id, Branch.all, :id, :name, { prompt: 'Select a branch' }, class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
          </div>
          <!-- Date Range Filters -->
          <div>
            <%= f.label :start_date, "Start Date", class: "block text-sm font-medium text-gray-700" %>
            <%= f.date_field :start_date, value: params[:start_date], class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
          </div>
          <div>
            <%= f.label :end_date, "End Date", class: "block text-sm font-medium text-gray-700" %>
            <%= f.date_field :end_date, value: params[:end_date], class: "mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" %>
          </div>
        </div>
        <!-- Submit and Clear Buttons -->
        <div class="flex space-x-4 mt-4">
          <%= f.submit "Filter", class: "px-4 py-2 bg-lightGreen text-white rounded-md hover:bg-lime-500" %>
          <%= link_to "Clear", requests_path, id:"reset-filter-button", class: "px-4 py-2 bg-gray-300 text-black rounded-md hover:bg-gray-400" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
<div class="relative overflow-x-auto shadow-md sm:rounded-lg">
  <table class="w-full text-sm text-left rtl:text-right text-gray-500">
    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
      <tr>
        <th scope="col" class="px-6 py-3 text-left">
          <span class="flex items-center gap-2">
            Name
            <svg width="10" height="10" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 5.16675H2C1.72667 5.16675 1.5 4.94008 1.5 4.66675C1.5 4.39341 1.72667 4.16675 2 4.16675H14C14.2733 4.16675 14.5 4.39341 14.5 4.66675C14.5 4.94008 14.2733 5.16675 14 5.16675Z" fill="#00092E"/>
              <path d="M12 8.5H4C3.72667 8.5 3.5 8.27333 3.5 8C3.5 7.72667 3.72667 7.5 4 7.5H12C12.2733 7.5 12.5 7.72667 12.5 8C12.5 8.27333 12.2733 8.5 12 8.5Z" fill="#00092E"/>
              <path d="M9.33366 11.8333H6.66699C6.39366 11.8333 6.16699 11.6066 6.16699 11.3333C6.16699 11.0599 6.39366 10.8333 6.66699 10.8333H9.33366C9.60699 10.8333 9.83366 11.0599 9.83366 11.3333C9.83366 11.6066 9.60699 11.8333 9.33366 11.8333Z" fill="#00092E"/>
            </svg>
          </span>
        </th>
        <th scope="col" class="px-6 py-3">
          <span class="flex items-center gap-2">
            Phone Number
            <svg width="10" height="10" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 5.16675H2C1.72667 5.16675 1.5 4.94008 1.5 4.66675C1.5 4.39341 1.72667 4.16675 2 4.16675H14C14.2733 4.16675 14.5 4.39341 14.5 4.66675C14.5 4.94008 14.2733 5.16675 14 5.16675Z" fill="#00092E"/>
              <path d="M12 8.5H4C3.72667 8.5 3.5 8.27333 3.5 8C3.5 7.72667 3.72667 7.5 4 7.5H12C12.2733 7.5 12.5 7.72667 12.5 8C12.5 8.27333 12.2733 8.5 12 8.5Z" fill="#00092E"/>
              <path d="M9.33366 11.8333H6.66699C6.39366 11.8333 6.16699 11.6066 6.16699 11.3333C6.16699 11.0599 6.39366 10.8333 6.66699 10.8333H9.33366C9.60699 10.8333 9.83366 11.0599 9.83366 11.3333C9.83366 11.6066 9.60699 11.8333 9.33366 11.8333Z" fill="#00092E"/>
            </svg>
          </span>
        </th>
        <th scope="col" class="px-6 py-3">
          <span class="flex items-center gap-2">
            Address
            <svg width="10" height="10" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 5.16675H2C1.72667 5.16675 1.5 4.94008 1.5 4.66675C1.5 4.39341 1.72667 4.16675 2 4.16675H14C14.2733 4.16675 14.5 4.39341 14.5 4.66675C14.5 4.94008 14.2733 5.16675 14 5.16675Z" fill="#00092E"/>
              <path d="M12 8.5H4C3.72667 8.5 3.5 8.27333 3.5 8C3.5 7.72667 3.72667 7.5 4 7.5H12C12.2733 7.5 12.5 7.72667 12.5 8C12.5 8.27333 12.2733 8.5 12 8.5Z" fill="#00092E"/>
              <path d="M9.33366 11.8333H6.66699C6.39366 11.8333 6.16699 11.6066 6.16699 11.3333C6.16699 11.0599 6.39366 10.8333 6.66699 10.8333H9.33366C9.60699 10.8333 9.83366 11.0599 9.83366 11.3333C9.83366 11.6066 9.60699 11.8333 9.33366 11.8333Z" fill="#00092E"/>
            </svg>
          </span>
        </th>
        <th scope="col" class="px-6 py-3">
          <span class="flex items-center gap-2">
            Request type
            <svg width="10" height="10" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 5.16675H2C1.72667 5.16675 1.5 4.94008 1.5 4.66675C1.5 4.39341 1.72667 4.16675 2 4.16675H14C14.2733 4.16675 14.5 4.39341 14.5 4.66675C14.5 4.94008 14.2733 5.16675 14 5.16675Z" fill="#00092E"/>
              <path d="M12 8.5H4C3.72667 8.5 3.5 8.27333 3.5 8C3.5 7.72667 3.72667 7.5 4 7.5H12C12.2733 7.5 12.5 7.72667 12.5 8C12.5 8.27333 12.2733 8.5 12 8.5Z" fill="#00092E"/>
              <path d="M9.33366 11.8333H6.66699C6.39366 11.8333 6.16699 11.6066 6.16699 11.3333C6.16699 11.0599 6.39366 10.8333 6.66699 10.8333H9.33366C9.60699 10.8333 9.83366 11.0599 9.83366 11.3333C9.83366 11.6066 9.60699 11.8333 9.33366 11.8333Z" fill="#00092E"/>
            </svg>
          </span>
        </th>
        <th scope="col" class="px-6 py-3">
          <span class="flex items-center gap-2">
            Status
            <svg width="10" height="10" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 5.16675H2C1.72667 5.16675 1.5 4.94008 1.5 4.66675C1.5 4.39341 1.72667 4.16675 2 4.16675H14C14.2733 4.16675 14.5 4.39341 14.5 4.66675C14.5 4.94008 14.2733 5.16675 14 5.16675Z" fill="#00092E"/>
              <path d="M12 8.5H4C3.72667 8.5 3.5 8.27333 3.5 8C3.5 7.72667 3.72667 7.5 4 7.5H12C12.2733 7.5 12.5 7.72667 12.5 8C12.5 8.27333 12.2733 8.5 12 8.5Z" fill="#00092E"/>
              <path d="M9.33366 11.8333H6.66699C6.39366 11.8333 6.16699 11.6066 6.16699 11.3333C6.16699 11.0599 6.39366 10.8333 6.66699 10.8333H9.33366C9.60699 10.8333 9.83366 11.0599 9.83366 11.3333C9.83366 11.6066 9.60699 11.8333 9.33366 11.8333Z" fill="#00092E"/>
            </svg>
          </span>
        </th>
        <th scope="col" class="px-6 py-3">
          <span class="flex items-center gap-2">
            Actions
            <svg width="10" height="10" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 5.16675H2C1.72667 5.16675 1.5 4.94008 1.5 4.66675C1.5 4.39341 1.72667 4.16675 2 4.16675H14C14.2733 4.16675 14.5 4.39341 14.5 4.66675C14.5 4.94008 14.2733 5.16675 14 5.16675Z" fill="#00092E"/>
              <path d="M12 8.5H4C3.72667 8.5 3.5 8.27333 3.5 8C3.5 7.72667 3.72667 7.5 4 7.5H12C12.2733 7.5 12.5 7.72667 12.5 8C12.5 8.27333 12.2733 8.5 12 8.5Z" fill="#00092E"/>
              <path d="M9.33366 11.8333H6.66699C6.39366 11.8333 6.16699 11.6066 6.16699 11.3333C6.16699 11.0599 6.39366 10.8333 6.66699 10.8333H9.33366C9.60699 10.8333 9.83366 11.0599 9.83366 11.3333C9.83366 11.6066 9.60699 11.8333 9.33366 11.8333Z" fill="#00092E"/>
            </svg>
          </span>
        </th>
      </tr>
    </thead>
    <tbody>
   
    <% @requests.each_with_index do |request, index| %>
        <tr class="bg-white border-b hover:bg-gray-50">
          <!-- Request Name -->
          <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
            <%= request.name %>
          </th>
          <!-- Phone Number -->
          <td class="px-6 py-4">
            <%= request.phone_number %>
          </td>
          <!-- Address -->
          <td class="px-6 py-4">
            <%= request.residence_address %>
          </td>
          <!-- Request Type -->
          <td class="px-6 py-4">
            <%= request.request_type %>
          </td>
          <!-- Request Status -->
          <td class="px-6 py-4">
            <i class="fa-solid fa-square-check" style="color: #6DC13D;"></i>
            fulfilled
          </td>
          <!-- Dropdown Menu for Actions -->
          <td class="px-6 py-4">
            <div class="relative inline-block text-left">
              <button type="button" onclick="toggleDropdown(<%= request.id %>)" data-request-type="<%= request.request_type %>" class="rounded-md border border-gray-300 shadow-sm p-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none flex justify-center items-center">
                Actions
                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 011.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
              </button>
              <div id="dropdown-<%= request.id %>" class="hidden absolute z-10 right-0 <%= 'bottom-full mb-2' if index >= 4 %> w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5">
                <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
                  <%= link_to 'Show', request, class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                  <%= link_to 'Edit', edit_request_path(request), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                  <%= button_to 'Destroy', request, method: :delete, data: { confirm: 'Are you sure?' }, class: 'block px-4 py-2 text-sm text-red-600 hover:bg-gray-100' %>
                  <%= link_to 'Individual Beneficiary', new_request_individual_beneficiary_path(request), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                  <%= link_to 'Family Beneficiary', new_request_family_beneficiary_path(request), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                  <%= link_to 'Organization Beneficiary', new_request_organization_beneficiary_path(request), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                  <%= link_to 'Food Donation Form', new_request_inventory_path(request, type: 'food'), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                  <%= link_to 'Cash Donation Form', new_request_inventory_path(request, type: 'cash'), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                  <%= link_to 'Cloth Donation Form', new_request_inventory_path(request, type: 'cloth'), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                  <%= link_to 'Other Items Donation Form', new_request_inventory_path(request, type: 'other_items'), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                </div>
            <% if request.user_id.present? %>
              <% case request.is_selected %>
              <% when true %>
              <span class="font-medium text-lime-500">Approved</span>
              <% when false %>
              <span class="font-medium text-red-600">Rejected</span>
            <% else %>
              <span class="font-medium text-yellow-400">Assigned</span>
            <% end %>
          <% else %>
            <span class="font-medium text-darkBlue">Not Assigned</span>
          <% end %>
        </td>
        <!-- Dropdown Menu for Actions -->
        <td class="px-6 py-4">
          <div class="relative inline-block text-left">
            <button type="button" onclick="toggleDropdown(<%= request.id %>)" data-request-type="<%= request.request_type %>" class="rounded-md border border-gray-300 shadow-sm p-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none flex justify-center items-center">
              Actions
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 011.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
            <div id="dropdown-<%= request.id %>" class="hidden absolute z-10 right-0 <%= 'bottom-full mb-2' if index >= 4 %> w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5">
              <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
                <%= link_to 'Details', request, class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                <%= link_to 'Update', edit_request_path(request), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                <%= button_to 'Delete', request, method: :delete, data: { confirm: 'Are you sure?' }, class: 'block px-4 py-2 text-sm text-red-600 hover:bg-gray-100' %>
                <%= link_to 'Individual Beneficiary', new_request_individual_beneficiary_path(request), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                <%= link_to 'Family Beneficiary', new_request_family_beneficiary_path(request), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                <%= link_to 'Organization Beneficiary', new_request_organization_beneficiary_path(request), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
                <%= link_to 'Add Inventory', new_request_inventory_path(request), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100' %>
              </div>
            </div>

          </td>
        </tr>
       
      <% end %>
    </tbody>
  </table>

</div>